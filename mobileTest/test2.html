<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>D3 Mobile Testing</title>
  <meta charset="utf-8" />
</head>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
<style>
  body, html {
    width:100%;
    height:100%;
  }
  #vizcontainer {
    width:100%;
    height:100%;
  }
  svg {
    width: 100%;
    height: 100%;
  }
  #buttons {
    width: 100%;
    height: 100%;
    position: fixed;
    z-index: 1;
    top: 0;
  }
  button {
    width: 100%;
    height: 15%;
  }
  #modal {
    position: absolute;
    height: 130px;
    width: 200px;
    background: white;
    box-shadow: 2px 2px 0px #888888;
    border: 1px #888888 solid;
    left: -300px;
    top: -300px;
  }
  #modal > p {
    margin: 2px;
    padding: 2px;
  }
  rect.extent {
    opacity: .25;
  }
  g.resize > circle {
    fill: lightgray;
    stroke: black;
    stroke-width: 5px;
  }
  
  text.brushLabel {
    font-size: 40px;
    font-weight: 900;
    text-anchor: middle;
    opacity: .5;
    pointer-events: none;
  }
  
  text.viewTitle {
    font-size: 30px;
    font-weight: 900;
    text-anchor: middle;
    fill: darkred;
  }

  text.viewStats {
    font-size: 24px;
    font-weight: 900;
    text-anchor: middle;
  }

        d3.select("#header").append("text").attr("class", "viewTitle")

      d3.select("svg").append("g").attr("id", "footer").attr("transform", "translate(0," + (screenHeight - 100) +")");
      d3.select("#footer").append("text").attr("class", "viewStats")
</style>
<body>

<div id="vizcontainer">
<svg></svg>
<div id="buttons">
  <button onclick="touchDemo7();">All Three</button>
  <button onclick="touchDemo8();">Nested G Elements</button>
  <button onclick="touchDemo9();">Visualizing Rotate</button>
  <button onclick="touchDemo10();">Responsive Data Viz</button>
</div>
</div>
  <footer>
<script>
  function touchDemo7() {
    var initialD = [];
    var initialTransform;

    d3.select("#buttons").html("").style("pointer-events", "none").append("div").attr("id", "touchStatus").append("p").html("Touch Status:").append("ol");

    d3.select("svg").on("touchstart", touchBegin);
    d3.select("svg").on("touchend", touchBegin);
    d3.select("svg").on("touchmove", touchUpdate);

    var touchColor = d3.scale.linear().domain([0, 10]).range(["pink", "darkred"])

    var graphicsG = d3.select("svg").append("g").attr("id", "graphics")
    .attr("transform-origin", "250 250");

  sampleData = d3.range(10).map(function(d) {
    var datapoint = {};
    datapoint.id = "Sample " + d;
    datapoint.x = Math.random() * 500;
    datapoint.y = Math.random() * 500;
    return datapoint;
  })
     
     var samples = graphicsG.selectAll("g")
     .data(sampleData)
     .enter()
     .append("g")
     .attr("transform", function(d) {return "translate("+d.x+","+d.y+")"});
     
     var sampleSubG = samples.append("g").attr("class", "sample");
     sampleSubG.append("rect").attr("width", 100).attr("height", 100)
     .style("fill", "red").style("stroke", "gray").style("stroke-width", "1px");

     sampleSubG.append("text").text(function (d) {return d.id}).attr("y", 20);

    function touchBegin() {
      d3.event.preventDefault();
      d3.event.stopPropagation();
       
      d = d3.touches(this);
      initialD = d;
      initialTransform = d3.transform(d3.select("#graphics").attr("transform"));

          }
     function touchUpdate() {
       d3.event.preventDefault();
       d3.event.stopPropagation();
       d = d3.touches(this);
       d3.select("svg").selectAll("circle.fingertips").data(d).enter().append("circle")
       .attr("class", "fingertips").attr("r", 75).style("fill", function(d, i) {
         return touchColor(i)
       });

       d3.select("svg").selectAll("circle.fingertips").data(d).exit().remove();

       d3.select("svg").selectAll("circle.fingertips").attr("cx", function(d) {
         return d[0]
       }).attr("cy", function(d) {
         return d[1]
       });
       
        var newX = initialTransform.translate[0];
        var newY = initialTransform.translate[1];
        var newRotate = initialTransform.rotate;
        var newScale = initialTransform.scale[0];

      d3.select("#touchStatus").html("")

      if (d.length == 1) {
        newX = -(initialD[0][0] - d[0][0] - initialTransform.translate[0]);
        newY = -(initialD[0][1] - d[0][1] - initialTransform.translate[1]);
      }
      else if (d.length == 2) {
        d3.select("#touchStatus").append("p").html("Two Fingers");

        var initialLength = Math.sqrt(Math.abs(initialD[0][0] - initialD[1][0]) + Math.abs(initialD[0][1] - initialD[1][1]));
        var currentLength = Math.sqrt(Math.abs(d[0][0] - d[1][0]) + Math.abs(d[0][1] - d[1][1]));
        var zoom = currentLength / initialLength;
        newScale = zoom * initialTransform.scale[0];
      }
      else if (d.length == 3) {
        var slope1 = (initialD[0][1] - initialD[1][1]) / (initialD[0][0] - initialD[1][0]);
        var slope2 = (d[0][1] - d[1][1]) / (d[0][0] - d[1][0]);
        
        var angle = Math.atan((slope1 - slope2)/(1 + slope1*slope2)) * 180/Math.PI;
        var newRotate = initialTransform.rotate - angle;

        d3.selectAll("g.sample > text").attr("transform", "rotate(" +(-newRotate)+")")

      }

        d3.select("#touchStatus").append("p").html("New Scale: " + newScale);
      
      d3.select("#graphics").attr("transform", "translate(" +(newX) +"," + (newY) + ") scale("+newScale+") rotate(" + newRotate + ")")

     }

  }

    function touchDemo8() {
    var initialD = [];
    var initialTransform;

    d3.select("#buttons").html("").style("pointer-events", "none").append("div").attr("id", "touchStatus").append("p").html("Touch Status:").append("ol");

    d3.select("svg").on("touchstart", touchBegin);
    d3.select("svg").on("touchend", touchBegin);
    d3.select("svg").on("touchmove", touchUpdate);

    var touchColor = d3.scale.linear().domain([0, 10]).range(["blue", "darkred"])

    var graphicsG = d3.select("svg").append("g").attr("id", "pan").append("g").attr("id", "zoom").append("g").attr("id", "rotate").attr("transform", "rotate(0)");

  sampleData = d3.range(10).map(function(d) {
    var datapoint = {};
    datapoint.id = "Sample " + d;
    datapoint.x = Math.random() * 500;
    datapoint.y = Math.random() * 500;
    return datapoint;
  })
     
     var samples = graphicsG.selectAll("g")
     .data(sampleData)
     .enter()
     .append("g")
     .attr("transform", function(d) {return "translate("+d.x+","+d.y+")"});
     
     var sampleSubG = samples.append("g").attr("class", "sample");
     sampleSubG.append("rect").attr("width", 100).attr("height", 100)
     .style("fill", "red").style("stroke", "gray").style("stroke-width", "1px");

     sampleSubG.append("text").text(function (d) {return d.id}).attr("y", 20);

    function touchBegin() {
      d3.event.preventDefault();
      d3.event.stopPropagation();
       
      d = d3.touches(this);
      initialD = d;
      panTransform = d3.transform(d3.select("#pan").attr("transform"));
      zoomTransform = d3.transform(d3.select("#zoom").attr("transform"));
      rotateTransform = d3.transform(d3.select("#rotate").attr("transform"));

          }
     function touchUpdate() {
       d3.event.preventDefault();
       d3.event.stopPropagation();
       d = d3.touches(this);
        d3.select("#touchStatus").selectAll("p").remove();
        d3.select("#touchStatus").append("p").html(d);

       d3.select("svg").selectAll("circle.fingertips").data(d).enter().append("circle")
       .attr("class", "fingertips").attr("r", 75).style("fill", function(d, i) {
         return touchColor(i)
       });

       d3.select("svg").selectAll("circle.fingertips").data(d).exit().remove();

       d3.select("svg").selectAll("circle.fingertips").attr("cx", function(d) {
         return d[0]
       }).attr("cy", function(d) {
         return d[1]
       });
       
        var newX = panTransform.translate[0];
        var newY = panTransform.translate[1];
        var newRotate = rotateTransform.rotate;
        var newScale = zoomTransform.scale[0];

      if (d.length == 1) {
        newX = -(initialD[0][0] - d[0][0] - panTransform.translate[0]);
        newY = -(initialD[0][1] - d[0][1] - panTransform.translate[1]);
        d3.select("#touchStatus").append("p").html("One Finger");
      }
      else if (d.length == 2) {
        var initialLength = Math.sqrt(Math.abs(initialD[0][0] - initialD[1][0]) + Math.abs(initialD[0][1] - initialD[1][1]));
        var currentLength = Math.sqrt(Math.abs(d[0][0] - d[1][0]) + Math.abs(d[0][1] - d[1][1]));
        var zoom = currentLength / initialLength;
        newScale = zoom * zoomTransform.scale[0];
        d3.select("#touchStatus").append("p").html("Two Fingers");
        d3.select("#touchStatus").append("p").html("Initial Scale: " + zoomTransform.scale[0]);
        d3.select("#touchStatus").append("p").html("Initial Length: " + initialLength);
        d3.select("#touchStatus").append("p").html("Current Length: " + currentLength);

      }
      else if (d.length == 3) {
        var slope1 = (initialD[0][1] - initialD[1][1]) / (initialD[0][0] - initialD[1][0]);
        var slope2 = (d[0][1] - d[1][1]) / (d[0][0] - d[1][0]);
        
        var angle = Math.atan((slope1 - slope2)/(1 + slope1*slope2)) * 180/Math.PI;
        var newRotate = rotateTransform.rotate - angle;

        d3.selectAll("g.sample > text").attr("transform", "rotate(" +(-newRotate)+")")
        d3.select("#touchStatus").append("p").html("Three Fingers");

      }

        d3.select("#touchStatus").append("p").html("Zoom: " + zoom);
        d3.select("#touchStatus").append("p").html("New Scale: " + newScale);
        d3.select("#touchStatus").append("p").html("New Rotate: " + newRotate);
      
      d3.select("#pan").attr("transform", "translate(" +(newX) +"," + (newY) + ")")
      d3.select("#zoom").attr("transform", "scale("+newScale + ")")
      d3.select("#rotate").attr("transform", "rotate(" + newRotate + ")")

     }

  }
  
  function touchDemo9() {
    var initialD = [];
    var initialRotate;

     d3.select("svg").on("touchstart", touchBegin);
     d3.select("svg").on("touchmove", touchStatus);

     var touchColor = d3.scale.linear().domain([0, 10]).range(["pink", "darkred"])
     
     var graphicsG = d3.select("svg").append("g").attr("id", "graphics").attr("transform", "translate(250,250)");
     
     graphicsG.append("rect").attr("width", 250).attr("height", 50).attr("x", 50).attr("y", 50)
     .style("fill", "lightgray").style("stroke", "gray").style("stroke-width", "1px");

     graphicsG.append("rect").attr("width", 100).attr("height", 400).attr("x", 350).attr("cy", 400)
     .style("fill", "lightgray").style("stroke", "gray").style("stroke-width", "1px");

      function touchBegin() {
      d3.event.preventDefault();
      d3.event.stopPropagation();
      initialD = d;
      initialRotate = d3.transform(d3.select("#graphics").attr("transform")).rotate;
       
       d = d3.touches(this);
      if (d.length == 3) {
        d3.select("svg").selectAll("line").remove();
        d3.select("svg").selectAll("text").remove();
        d3.select("svg").append("line")
        .attr("class", "initial")
        .style("stroke", function(d,i) {return i == 0 ? "red" : "black"})
        .style("stroke-width", function(d,i) {return i == 0 ? "20px" : "5px"})

      }

          }
     function touchStatus() {
       d3.event.preventDefault();
       d3.event.stopPropagation();
       d = d3.touches(this);
       d3.select("svg").selectAll("circle").data(d).enter().append("circle").attr("r", 75).style("fill", function(d, i) {
         return touchColor(i)
       });

       d3.select("svg").selectAll("circle").data(d).exit().remove();

       d3.select("svg").selectAll("circle").attr("cx", function(d) {
         return d[0]
       }).attr("cy", function(d) {
         return d[1]
       });

       var l = [];
       if (d.length > 1) {
         for (x in d) {
           for (y in d) {
             if (y != x) {
               var lineObj = {
                 source: d[x],
                 target: d[y]
               };
               l.push(lineObj);
             }
           }
         }
         d3.select("svg").selectAll("line.status").data(l).enter().append("line").attr("class", "status")
         .style("stroke", function(d,i) {return i == 0 ? "red" : "black"})
         .style("stroke-width", function(d,i) {return i == 0 ? "20px" : "5px"});

         d3.select("svg").selectAll("line.status").attr("x1", function(d) {
           return d.source[0]
         }).attr("y1", function(d) {
           return d.source[1]
         }).attr("x2", function(d) {
           return d.target[0]
         }).attr("y2", function(d) {
           return d.target[1]
         })

       }
       d3.select("svg").selectAll("line.status").data(l).exit().remove();

      if (d.length == 3) {
        var slope1 = (initialD[0][1] - initialD[1][1]) / (initialD[0][0] - initialD[1][0]);
        var slope2 = (d[0][1] - d[1][1]) / (d[0][0] - d[1][0]);
        var lineAdjust = [d[0][0] - (initialD[0][0] - initialD[1][0]), d[0][1] - (initialD[0][1] - initialD[1][1])]
        
        d3.select("text.newslope").remove();
        d3.select("text.firstslope").remove();

        d3.select("svg").append("text")
        .attr("x", (d[0][0] + lineAdjust[0]) / 2)
        .attr("y", (d[0][1] + lineAdjust[1]) / 2)
        .attr("class", "firstslope")
        .style("color", "darkred")
        .style("font-weight", 900)
        .text("Initial Slope: " + d3.format(".2f")(slope1));

        
        d3.select("line.initial")
        .attr("x1", d[0][0])
        .attr("x2", lineAdjust[0])
        .attr("y1", d[0][1])
        .attr("y2", lineAdjust[1])

        d3.select("svg").append("text")
        .attr("x", (d[0][0] + d[1][0]) / 2)
        .attr("y", (d[0][1] + d[1][1]) / 2)
        .attr("class", "newslope")
        .style("color", "darkred")
        .style("font-weight", 900)
        .text("Changed Slope: " + d3.format(".2f")(slope2));

        var angle = Math.atan((slope1 - slope2)/(1 + slope1*slope2)) * 180/Math.PI;
        
        var arcAngle1 = Math.atan2(d[0][1] - lineAdjust[1],d[0][0] - lineAdjust[0]);
        var arcAngle2 = Math.atan2((d[0][1] - d[1][1]),(d[0][0] - d[1][0]));
        
        var newArc = d3.svg.arc().innerRadius(100).outerRadius(200).startAngle(arcAngle1 - (Math.PI / 2)).endAngle(arcAngle2 - (Math.PI / 2));
        
        var altAngle = (arcAngle2 - arcAngle1) * (180/Math.PI)
        
        d3.select("svg").selectAll("g.arc").remove();
        d3.select("svg").insert("g","g").attr("class","arc").attr("transform", "translate("+d[0][0]+","+d[0][1]+")").append("path").attr("class", "arc").attr("d", newArc).style("fill", "#B2B2CC")
        
        d3.select("g.arc").append("text").text(d3.format(".2f")(altAngle) + " degrees").attr("transform", "translate(" +newArc.centroid()[0] +","+ newArc.centroid()[1]+")").style("font-size", "24px").style("font-weight", 900)
        
        var newRotate = initialRotate - altAngle;
        
        d3.select("#graphics").attr("transform", "translate(250,250) rotate(" +newRotate +")")

      }

     }

   }
   
   function touchDemo10() {
    d3.select("#buttons").remove();
    responsiveDataViz();
   }
   
   function responsiveDataViz() {
    d3.json("realestate.json", function(data) {realEstate(data)});
    
    function realEstate(data) {
      d3.select("svg").style("width", "80%").style("float", "left");
      d3.select("#vizcontainer").append("div").attr("id", "list").style("float", "left").style("height", "90%").style("width", "18%").style("overflow", "auto");
      d3.select("#vizcontainer").append("div").attr("id", "modal");
      
      d3.select("#list").append("ol").selectAll("li").data(data).enter().append("li").attr("class", "datapoint").html(function(d) {return d.name})
      .on("mouseover", highlightDatapoint)
      screenHeight = parseFloat(d3.select("svg").node().clientHeight || d3.select("svg").node().parentNode.clientHeight);
      screenWidth = parseFloat(d3.select("svg").node().clientWidth || d3.select("svg").node().parentNode.clientWidth);

      sizeExtent = d3.extent(data, function(d) {return d.size})
      valueExtent = d3.extent(data, function(d) {return d.value})
      xScale = d3.scale.linear().domain(sizeExtent).range([40,screenWidth-40])
      yScale = d3.scale.linear().domain(valueExtent).range([screenHeight-40,40])
      d3.select("svg").append("g").attr("id", "dataG").selectAll("g.datapoint").data(data, function(d) {return d.name}).enter()
      .append("g").attr("class", "datapoint");
      
      
      locationScale = d3.scale.ordinal().domain(["Rural","Coastal","Suburb","City"]).range(colorbrewer.Reds[4]);
      typeShape = {"Spanish": "circle","Craftsman":"cross","Ranch":"square","McMansion":"triangle-down"};

      dataG = d3.selectAll("g.datapoint")
      .attr("transform", function(d) {return "translate(" + xScale(d.size) + "," + yScale(d.value) +")"})
      .each(function(d) {
      houseSymbol = d3.svg.symbol().type(typeShape[d.type]).size(64);
        d3.select(this).append("path")
        .attr("d", houseSymbol)
        .style("fill", locationScale(d.location))
      .style("stroke", "black")
      .style("stroke-width", "1px")
      .on("mouseover", highlightDatapoint)
      })
      
    xAxis = d3.svg.axis().scale(xScale).orient("top").tickSize(4);    
    yAxis = d3.svg.axis().scale(yScale).orient("right").tickSize(4);    
    d3.select("svg").append("g").attr("id", "xAxisG").attr("class", "axis").attr("transform", "translate(0,"+(screenHeight - 20)+")").call(xAxis);
    d3.select("svg").append("g").attr("id", "yAxisG").attr("class", "axis").attr("transform", "translate(20,0)").call(yAxis);
//    d3.select("body").append("button").html("Tablet").on("click", tabletView)
    
    phoneView();
     
    function highlightDatapoint(d) {
      d3.selectAll("li.datapoint").style("font-weight", function(p) {return p == d ? 900 : 100})
      d3.selectAll("g.datapoint").select("path").style("stroke-width", function(p) {return p == d ? "3px" : "1px"})
      var modal = d3.select("#modal").style("top", yScale(d.value) - 135).style("left", xScale(d.size) - 100);
      modal.selectAll("*").remove();
      modal.append("p").html(d.name)
      modal.append("p").html("Location: " + d.location)
      modal.append("p").html("Style: " + d.type)
      modal.append("p").html("Size: " + d.size + "Sq. Ft.")
      modal.append("p").html("Value: $" + d.value)
    }
    function tabletView() {
      d3.select("svg").style("width", "100%");

      screenWidth = parseFloat(d3.select("svg").node().clientWidth || d3.select("svg").node().parentNode.clientWidth);

      d3.select("#list").remove();
      var cellWidth = screenWidth / 18;
      var cellHeight = screenHeight / 14;
      sortedData = data.sort(function(a,b) {
    if (a.value > b.value)
    return 1;
    if (a.value < b.value)
    return -1;
    return 0;
    });
      d3.selectAll("g.datapoint").data(sortedData, function(d) {return d.name})
      .transition()
      .duration(1000)
      .attr("transform", function(d,i) {return "translate("+((Math.floor(i/6) + .5) * cellWidth)+","+((i%6 + .5)*cellHeight)+")"});

      d3.selectAll("g.datapoint").select("path")
      .on("mouseover", null)
      .each(function(d) {
      houseSymbol = d3.svg.symbol().type(typeShape[d.type]).size(512);
        d3.select(this).transition().duration(1000).attr("d", houseSymbol);
      })

    xScale.range([40,screenWidth-40])
    
    xAxis.orient("bottom").scale(xScale);

    yScale.range([40,screenWidth-40])
    yAxis.orient("bottom").scale(yScale);

    sizeBrush = d3.svg.brush()
      .x(xScale)
      .extent(sizeExtent)
      .on("brush", brushed);

    valueBrush = d3.svg.brush()
      .x(yScale)
      .extent(valueExtent)
      .on("brush", brushed);

    d3.select("#xAxisG").transition().duration(1000).attr("transform", "translate(0,"+(screenHeight - 150)+")").call(xAxis);
    d3.select("#yAxisG").transition().duration(1000).attr("transform", "translate(0,"+(screenHeight - 50)+")").call(yAxis);

    d3.select("#xAxisG").append("g").attr("class", "brushG").attr("transform", "translate(0,-80)").call(sizeBrush).insert("text", "rect").attr("class", "brushLabel").text("Square Footage").attr("x", screenWidth / 2).attr("y", 50);
    d3.select("#yAxisG").append("g").attr("class", "brushG").attr("transform", "translate(0,-80)").call(valueBrush).insert("text", "rect").attr("class", "brushLabel").text("Home Value").attr("x", screenWidth / 2).attr("y", 50);

    d3.selectAll(".brushG").selectAll("rect").attr("height", 80);
    d3.selectAll(".brushG").selectAll(".resize").append("circle").attr("r", 40).attr("cy", 40);
    function brushed() {
      d3.selectAll("g.datapoint").each(function(d) {
        var color = locationScale(d.location);
        if (d.value < valueBrush.extent()[0] || d.value > valueBrush.extent()[1] || d.size < sizeBrush.extent()[0] || d.size > sizeBrush.extent()[1]) {
          color = "lightgray";
        }
        d3.select(this).select("path").style("fill", color);
      })
    }
      
    }
    function phoneView() {
      for (x in data) {
        data[x].oValue = data[x].value;
      }
      nestedTweets = d3.nest()
      .key(function (d) {return d.location})
      .entries(data);
      
      for (x in nestedTweets) {
      var subNestedTweets = d3.nest()
      .key(function (d) {return d.type})
      .entries(nestedTweets[x].values);
      nestedTweets[x].values = subNestedTweets;
      }

      packableTweets = {id: "root", key: "Overall", values: nestedTweets}

      d3.select("svg").style("width", "100%");

      screenWidth = parseFloat(d3.select("svg").node().clientWidth || d3.select("svg").node().parentNode.clientWidth);
      d3.select("#list").remove();
      d3.selectAll("g.axis").remove();

      circleSize = d3.scale.linear().domain(sizeExtent).range([2,10])

      packChart = d3.layout.pack();
      packChart.size([screenWidth,screenHeight-200])
      .children(function(d) {return d.values})
      .value(function(d) {return circleSize(d.size)})

      d3.select("#dataG")
      .attr("transform", "translate(0,100)")
      .selectAll("circle")
      .data(packChart(packableTweets))
      .enter()
      .append("circle")
      .attr("r", function(d) {return d.r})
      .attr("cx", function(d) {return d.x})
      .attr("cy", function(d) {return d.y})
      .style("fill", "rgba(0,0,0,0)")
      .style("stroke", "black")
      .style("stroke-width", "2px");
      
      d3.selectAll("g.datapoint").transition().duration(1000)
      .attr("transform", function(d) {return "translate(" + d.x + "," + d.y +")"})

      symbolSize = d3.scale.linear().domain(sizeExtent).range([100,180])

      d3.selectAll("g.datapoint").select("path")
      .on("mouseover", null)
      .each(function(d) {
      houseSymbol = d3.svg.symbol().type(typeShape[d.type]).size(symbolSize(d.size));
        d3.select(this).transition().duration(1000).attr("d", houseSymbol);
      })
      
      d3.select("svg").append("g").attr("id", "header").attr("transform", "translate(" + (screenWidth / 2) + ",50)");
      d3.select("#header").append("text").attr("class", "viewTitle").text("Current View")

      d3.select("svg").append("g").attr("id", "footer").attr("transform", "translate(" + (screenWidth / 2) + "," + (screenHeight - 60) +")");
      d3.select("#footer").append("text").attr("class", "viewStats").attr("id", "viewPrice").text("Average Value");
      d3.select("#footer").append("text").attr("class", "viewStats").attr("id", "viewPrice").attr("y", 30).text("Average Size");
      
      function changeView(d) {
        d3.select("#dataG").selectAll("circle").style("pointer-events", function(p) {return p.depth == d.depth - 1 ? "auto" : "none"}) 
        d3.select("#dataG").attr("transform", "translate(" + d.x + "," + (d.y + 100) +")");
      }

      }
    }
   }
</script>
  </footer>
</body>
</html>